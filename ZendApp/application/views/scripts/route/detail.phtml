<input type="hidden" id="email-confirmed" value="<?= ((!is_null($this->user)) && $this->user->isConfirmed) ? 1 : 0 ?>">
<input type="hidden" id="routeId" value="<?= $this->route->routeId ?>">
<input type="hidden" id="ratingId" value="<?= $this->userRouteRating->ratingId ?>">

<div class="row containingRow">
    <div class="col-md-7">
        <div class="row topBar">
            <div class="col-md-8">
                <h3 class="title">
                    <?= $this->route->name ?>
                    <? if (!(is_null($this->user)) && ($this->user->username != $this->route->owner)) { ?>
                        <span id="reportRoute">
                            (<i class="fa fa-flag"></i> Report?)
                        </span>
                    <? } ?>
                </h3>
                <div class="owner">
                    By <?= $this->route->owner ?>
                </div>
            </div>

            <div class="col-md-4">
                <div class="row">
                    <div class="rating" id="ratingContainer">
                        <?= $this->partial('user', 'stars', null, array(
                            'rating' => $this->route->rating
                        )); ?>
                    </div>
                </div>

                <? if (!(is_null($this->user)) && ($this->user->username != $this->route->owner)) { ?>
                    <div class="row">
                            <div class="yourRating">
                                Your rating
                                <? if ($this->userRouteRating->value > 0) { ?>
                                    <span class="clearBtn">
                                        (<i class="fa fa-times"></i>)
                                    </span>
                                <? } ?>

                                <?= $this->partial('user', 'stars', null, array(
                                    'rating'   => $this->userRouteRating->value,
                                    'showId'   => true,
                                    'addBreak' => true,
                                )); ?>
                            </div>
                    </div>
                <? } ?>
            </div>
        </div>

        <div class="row">
            <div class="col-md-6">
                <div class="thumbnail">
                    <img src="<?= $this->gmapUrl ?>">
                </div>

                <? if (count($this->points) > 25) { ?>
                    <div class="omitted">
                        Some points have been omitted from the image above
                    </div>
                <? } ?>

                <a class="btnLink" target="_blank" href="/route/openingooglemaps/id/<?= $this->route->routeId ?>">
                    <button class="btn btn-success btn-nopad">
                        <i class="fa fa-street-view"></i> Open in Google Maps
                    </button>
                </a>
                <br>
                <? if (!(is_null($this->user))) { ?>
                    <a class="btnLink" href="/route/fork/id/<?= $this->route->routeId ?>">
                        <button class="btn btn-warning btn-nopad">
                            <i class="fa fa-code-fork"></i> Fork Route
                        </button>
                    </a>
                    <br>
                <? } ?>
                <a class="btnLink" target="_blank" href="/route/download/id/<?= $this->route->routeId ?>">
                    <button class="btn btn-primary btn-nopad">
                        <i class="fa fa-download"></i> Download
                    </button>
                </a>
                <br>
                <? if ($this->route->owner == $this->user->username || $this->user->isAdmin) { ?>
                    <button class="btn btn-danger btn-nopad" id="deleteRoute">
                        <i class="fa fa-street-view"></i> Delete Route
                    </button>
                <? } ?>

            </div>
            <div class="col-md-6">
                <div class="border-container">
                    <div class="title routedetailTitle">
                        Route Details
                    </div>
                    <div>
                        <b>Start</b><br>
                        <span id="start_point" data-latlng="<?= $this->firstPoint ?>"></span>
                    </div>
                    <br>
                    <div>
                        <b>End</b><br>
                        <span id="end_point" data-latlng="<?= $this->lastPoint ?>"></span>
                    </div>
                    <br>
                    <div>
                        <b>Author Description</b><br>
                        <i><?= $this->route->description ?></i>
                    </div>
                </div>

                <div class="border-container">
                    <div class="title routestatsTitle">
                        Route Stats
                    </div>
                    <div class="stats">
                        <i class="fa fa-comment"></i> <?= $this->route->comments ?> comments
                        <br>
                        <i class="fa fa-star"></i> <?= $this->route->ratings ?> ratings
                        <br>
                        <i class="fa fa-share"></i> <?= $this->route->shares ?> shares
                        <br>
                        <i class="fa fa-download"></i> <?= $this->route->downloads ?> downloads
                        <br>
                        <i class="fa fa-code-fork"></i> <?= $this->route->forks ?> forks
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-5" id="socialStream">
        <div class="border-container">
            <div class="title routessTitle">
                Social Stream
            </div>

            <div class="shareThisRoute">
                <div class="bold">
                    Like this route? Why not share it?
                </div>
                <div class="shareButtons">
                    <div class="a2a_kit a2a_default_style">
                        <a class="a2a_dd" href="https://www.addtoany.com/share">Share</a>
                        <span class="a2a_divider"></span>
                        <a class="a2a_button_facebook"></a>
                        <a class="a2a_button_twitter"></a>
                        <a class="a2a_button_google_plus"></a>
                        <a class="a2a_button_pinterest"></a>
                        <a class="a2a_button_email"></a>
                        <a class="a2a_button_reddit"></a>
                        <a class="a2a_button_tumblr"></a>
                    </div>
                    <script type="text/javascript" src="/libs/addtoany/buttons.js"></script>
                    <script type="text/javascript">

                    </script>
                </div>
            </div>

            <? if (!(is_null($this->user)) && ($this->user->username != $this->route->owner)) { ?>
                <div class="commentBox">
            <span class="bold">
                Got something to say?
            </span>
                    <div class="row">
                        <div class="input-group">
                            <textarea class="form-control custom-control" id="comment-input" rows="2"></textarea>
                            <span class="input-group-addon btn btn-success" id="comment-btn">Comment</span>
                        </div>
                    </div>
                </div>
            <? } ?>

            <div class="streamElements">
                <label id="filterComments" class="right">
                    <input type="checkbox"> Only show comments?
                </label>
                <div class="bold">See what others thought:</div>

                <div class="elements">
                    <? if (count($this->socialStream) > 0) { ?>
                        <? foreach ($this->socialStream as $element) { ?>
                            <div class="streamElement <?= $element->type ?>">
                                <i class="<?= $element->icon ?>"></i>
                                <? if ($element->type == 'share') { ?>
                                    <i class="fa fa-<?= $element->valueString ?>-square"></i>
                                <? } ?>
                                <span class="bold"> <?= $element->username ?> </span>

                                <? if ($element->type === 'comment') { ?>
                                    <span class="right commentAction">
                                    <? if (!(is_null($this->user))) { ?>
                                        <? if ($element->username == $this->user->username || $this->user->isAdmin) { ?>
                                            <i class="fa fa-times"></i>
                                        <? } else { ?>
                                            <i class="fa fa-flag"></i>
                                        <? }
                                    } ?>
                                </span>
                                    says: <p> <?= $element->comment ?> </p>
                                    <input type="hidden" class="commentId" value="<?= $element->valueId ?>">
                                <? } else if ($element->type === 'rate') { ?>
                                    gave this route a rating of
                                    <span class="userRatingValue"><?= $element->rating ?></span>
                                    <i class="fa fa-star"></i>
                                    <? if (!is_null($this->user) && $element->username == $this->user->username) { ?>
                                        <div class="hidden" id="userRating"></div>
                                    <? } ?>

                                <? } else { ?>
                                    <?= rtrim($element->type, 'e') ?>ed this route
                                    <?= ($element->type == 'share' ? ' to ' . ucfirst($element->valueString) : '') ?>
                                <? } ?>
                            </div>
                        <? } ?>
                    <? } else { ?>
                        <? if ((!is_null($this->user)) && ($this->user->username == $this->route->owner)) { ?>
                            No one has said anything yet! Perhaps you should share your route with your friends?
                        <? } else { ?>
                            No one has said anything yet! Why not kick off the discussion?
                        <? } ?>
                    <? } ?>
                </div>
            </div>
        </div>
    </div>
</div>
